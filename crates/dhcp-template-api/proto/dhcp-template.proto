syntax = "proto3";
package dhcp_template;

service ControllerService {
  // Push state of the node to the controller.
  rpc PushNode(Update) returns (Refresh);
}

enum Scope {
  // Omit interfaces and only send the last pushed token.
  SHALLOW = 0;
  // Push the current state of the node.
  FULL = 1;
}

message Refresh {
  // The agent should not push sooner than backoff_seconds, unless the state changes.
  uint64 backoff_seconds = 1;
  // The agent must push with the given scope in the next iteration.
  Scope scope = 2;
}

message Update {
  uint64 token = 1;
  oneof data {
    Shallow shallow = 2;
    Node full = 3;
  };
}

message Shallow {
  string name = 1;
}

message Node {
  string name = 1;
  repeated Interface interfaces = 2;
}

message Interface {
  string name = 1;
  optional Lease4 lease4 = 2;
  optional Lease6 lease6 = 3;
}

message Lease4 {
  repeated string dns = 1;
  optional string domain = 2;
}

message Lease6 {
  repeated string dns = 1;
  repeated Prefix6 prefix6 = 2;
}

message Prefix6 {
  string ip = 1;
  uint32 len = 2;
}
